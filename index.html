<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASAN AI - Virtual K√∂m…ôk√ßi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="chat-wrapper">
        <div class="chat-container">
            <!-- Header -->
            <div class="chat-header">
                <div class="header-left">
                    <i class="fas fa-robot robot-icon"></i>
                    <div class="header-info">
                        <h2>ASAN AI Assistant</h2>
                        <span class="status online"><i class="fas fa-circle"></i> Online</span>
                    </div>
                </div>
                <div class="header-right">
                    <select id="orgSelector" class="org-select">
                        <option value="asan_xidmet">üè¢ ASAN Xidm…ôt</option>
                        <option value="dost">ü§ù DOST</option>
                        <option value="mygov">üì± MyGov</option>
                    </select>
                    <button class="btn-icon" id="clearChat"><i class="fas fa-trash-alt"></i></button>
                </div>
            </div>
            
            <!-- Messages -->
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="avatar"><i class="fas fa-robot"></i></div>
                    <div class="message-content">
                        <div class="message-text">
                            Salam! M…ôn ASAN AI k√∂m…ôk√ßisiy…ôm. Siz…ô nec…ô k√∂m…ôk ed…ô bil…ôr…ôm?
                        </div>
                        <span class="message-time">{{ now.strftime('%H:%M') }}</span>
                    </div>
                </div>
                
                <!-- Quick actions -->
                <div class="quick-actions">
                    <button class="quick-btn" data-question="Doƒüum haqqƒ±nda ≈ü…ôhad…ôtnam…ô">üìÑ Doƒüum ≈ü…ôhad…ôtnam…ôsi</button>
                    <button class="quick-btn" data-question="≈û…ôxsiyy…ôt v…ôsiq…ôsi nec…ô d…ôyi≈üdirilir?">üÜî ≈û…ôxsiyy…ôt v…ôsiq…ôsi</button>
                    <button class="quick-btn" data-question="Xarici pasport √º√ß√ºn n…ô lazƒ±mdƒ±r?">üåç Xarici pasport</button>
                    <button class="quick-btn" data-question="ASAN-ƒ±n i≈ü saatlarƒ±">‚è∞ ƒ∞≈ü saatlarƒ±</button>
                </div>
            </div>
            
            <!-- Input area -->
            <div class="chat-input-area">
                <div class="input-wrapper">
                    <button class="btn-icon attach"><i class="fas fa-paperclip"></i></button>
                    <input type="text" id="userInput" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n..." autocomplete="off">
                    <button class="btn-icon emoji"><i class="fas fa-smile"></i></button>
                    <button class="btn-send" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="typing-indicator" id="typingIndicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script>
        // Chat JavaScript
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const orgSelector = document.getElementById('orgSelector');
        
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = message ${sender};
            
            const time = new Date().toLocaleTimeString('az-AZ', { hour: '2-digit', minute: '2-digit' });
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content user-content">
                        <div class="message-text">${text}</div>
                        <span class="message-time">${time}</span>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="avatar"><i class="fas fa-robot"></i></div>
                    <div class="message-content">
                        <div class="message-text">${text.replace(/\n/g, '<br>')}</div>
                        <span class="message-time">${time}</span>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            addMessage(message, 'user');
            userInput.value = '';
            
            typingIndicator.style.display = 'flex';
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: message,
                        org_id: orgSelector.value
                    })
                });
                
                const data = await response.json();
                typingIndicator.style.display = 'none';
                addMessage(data.answer, 'bot');
            } catch (error) {
                typingIndicator.style.display = 'none';
                addMessage('X…ôta ba≈ü verdi. Z…ôhm…ôt olmasa yenid…ôn c…ôhd edin.', 'bot');
            }
        }
        
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        // Quick buttons
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                userInput.value = btn.dataset.question;
                sendMessage();
            });
        });
        
        // Clear chat
        document.getElementById('clearChat').addEventListener('click', () => {
            chatMessages.innerHTML = '';
            addMessage('Salam! M…ôn ASAN AI k√∂m…ôk√ßisiy…ôm. Siz…ô nec…ô k√∂m…ôk ed…ô bil…ôr…ôm?', 'bot');
            
            // Quick actions-ƒ± yenid…ôn …ôlav…ô et
            const quickActions = document.createElement('div');
            quickActions.className = 'quick-actions';
            quickActions.innerHTML = `
                <button class="quick-btn" data-question="Doƒüum haqqƒ±nda ≈ü…ôhad…ôtnam…ô">üìÑ Doƒüum ≈ü…ôhad…ôtnam…ôsi</button>
                <button class="quick-btn" data-question="≈û…ôxsiyy…ôt v…ôsiq…ôsi nec…ô d…ôyi≈üdirilir?">üÜî ≈û…ôxsiyy…ôt v…ôsiq…ôsi</button>
                <button class="quick-btn" data-question="Xarici pasport √º√ß√ºn n…ô lazƒ±mdƒ±r?">üåç Xarici pasport</button>
                <button class="quick-btn" data-question="ASAN-ƒ±n i≈ü saatlarƒ±">‚è∞ ƒ∞≈ü saatlarƒ±</button>
            `;
            chatMessages.appendChild(quickActions);
        });
    </script>
</body>
</html>
